<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xmlns:mso="urn:schemas-microsoft-com:office:office" xmlns:msdt="uuid:C2F41010-65B3-11d1-A29F-00AA00C14882">

<head>

<!--Article Number is 17347 -->



<title>Build a LEMP stack (Linux, NGINX, MySQL, PHP) - Ubuntu</title>
<style type="text/css">
div.hacker {
background-color:#666;
border:1px solid #ccc;
color:#fff;
font-family:"Lucida Console","Courier New",Courier,fixed;  font-size:95%;  line-height:160%;  margin-bottom:1.5em;  padding:10px; }

p.note {
 background-color:#ffffe6;
 border:1px solid #eee;
 color:#666;
 padding:.8em 1.6em;
 margin:15px 0;
}

.warning {
 border: 1px #d25100 solid;
 padding: .5em 1em .5em 4em;
 margin: 10px 20px 15px 20px;
 background-image: url('@{help-img-path}/img_warning.gif');
 background-repeat: no-repeat;
 background-position: left top;
 background-color: #ededed;-moz-border-radius:
0.8em;-webkit-border-radius: 0.8em;
 /* -moz-border-bottom-radius: 0;9 */
 -webkit-border-bottom-radius: 0;
 padding-top:14px;
 padding-bottom:15px;
}
table {border-collapse: collapse; color: #333; margin: 1.2rem 0;}
tr:nth-child(odd) {background-color: #f7f7f7 
;}
tr:nth-child(1) {background-color:#ddd;}
th{ border-right: 1px solid #ddd; padding: 5px; text-align:left;}
td{border: 1px solid #b2b2b2 
;padding: 5px;vertical-align:top;}


td:nth-child(1) {font-weight:bold;}
    </style>


</head>

<body>
<p>Install and configure a LEMP stack on an Unbuntu server.</p>
    <h1>Build a LEMP stack (Linux, NGINX, MySQL, PHP) - Ubuntu</h1>
    
    <p><strong>Difficulty</strong>: <em><u>3</u></em><br/>
        <strong>Time</strong>: <em><u>20 minutes</u></em></p>

<p>To build a dynamic web application, you need what has been coined a “stack” – which is developer lingo for an integrated set of software that has all of the components your application needs.</p>

<p>Most stacks have the same types of component, and differ mainly in which pieces of software they use for those components. For example, we’ll look at LEMP (which this article covers):</p>

<table>
  <tr>
    <th>Component</th>
    <th>LAMP Software</th>
  </tr>
  <tr>
      <td>Operating system</td>
      <td><em>L</em>inux (e.g. Ubuntu)</td>
  </tr>
  <tr>
      <td>Web server</td>
      <td>NGINX (pronounced <em>e</em>ngine-x)</td>
  </tr>
  <tr>
      <td>Database</td>
      <td><em>M</em>ySQL</td>
  </tr>
  <tr>
      <td>Programming language</td>
      <td><em>P</em>HP</td>
  </tr>
</table>

<p>If you're astute, maybe you noticed that LEMP is basically an acronym for the software the stack uses (LNMP is difficult to pronounce in English, so they used “E” for NGINX because of its pronunciation).</p>

<p>In this guide, we'll walk you through installing all of these compontents (except for Linux, which is already installed as your OS when you create the server).</p>
    
<h2>Install and start NGINX</h2>
<p>
<ol>
  <li>Install NGINX:
    <div class="hacker">sudo apt-get install nginx</div></li>
  <li>Start the NGINX service:
    <div class="hacker">sudo service nginx start</div></li>
  <li>To verify that NGINX is installed, type this URL in a browser:<br/>
        <strong>http://<em><u>your server's IP address</u></em></strong>
        <p class="note">COMPANY_NAME Cloud Server customers can use <article id="19041" />.</li>
 </ol>

<p>If NGINX is installed, a <strong>Welcome to nginx!</strong> page displays.</p>
    
<h2>Install MySQL</h2>
<ol>
  <li>Update all of your server's <code>apt</code> packages:
    <div class="hacker">sudo apt-get update</div></li>
   <li>Install MySQL:
    <div class="hacker">sudo apt-get install mysql-server php5-mysql</div></li>
  <li>Activate MySQL:
    <div class="hacker">sudo mysql_install_db</div>
    MySQL will ask you for a db admin password. Skip this step for now by pressing <strong>enter/return</strong>.</li>
  <li>Secure your database server:
    <div class="hacker">sudo /usr/bin/mysql_secure_installation</div> 
  The prompt will request the answer to a number of questions:
    <table>
    <tr>
      <th>Question</th>
      <th>Suggested Answer</th>
      <th>Reasoning</th>
    </tr>
    <tr>
        <td>Enter current password for root:</td>
        <td>Press <strong>Enter</strong> for none.</td>
        <td>Do not enter a password. If you do so, MySQL will not have sufficient access to system resources to function as a database server.</td>
    </tr>
    <tr>
        <td>Do you want to change the root password?</td>
        <td>y</td>
        <td>A password is needed to secure MySQL. Enter a strong password and write it down.</td>
    </tr>
    <tr>
        <td>Remove anonymous users?</td>
        <td>y</td>
        <td>The anonymous user allows anyone to login without requiring an account created by an admin. A hacker attempting to compromise your database server may try logging in as this user. </td>
    </tr>
    <tr>
        <td>Disallow root login remotely?</td>
        <td>y</td>
        <td>It is more secure to create a non-root user with admin permissions. Answer "no," if you need more flexibility to manage your db server.</td>
    </tr>
    <tr>
      <td >Remove test database and access to it?</td>
        <td>y</td>
        <td>If you have a reason to keep a test database, answer "no." </td>
    </tr>
    <tr>
      <td >Reload privilege tables now?</td>
        <td>y</td>
        <td>Why wait?</td>
    </tr>
</table></li>          
</ol>                 
                     
<h2>Install and configure PHP</h2>
<h3>Install PHP</h3>
<ul>
  <li>Install PHP:
     <div class="hacker">sudo apt-get install php5-fpm</div></li>
 </ul>

<h3>Configure the php.ini file</h3>
<ol>
  <li>Open <code>/etc/php5/fpm/php.ini</code>:
    <div class="hacker">sudo vim /etc/php5/fpm/php.ini</div></li>
  <li>Find the <code>cgi.fix_pathinfo</code> directive.  Most of the file is commented out. It will be about halfway through the file, under a section called <code>Paths and Directories</code>.</li>  
  <li>Uncomment the line and set it as follows:
         <div class="hacker">cgi.fix_pathinfo=0</div></li>
  <li>Save and close the file:
      <div class="hacker">:wq!</div></li>
</ol> 
       
<h3>Configure the www.conf file</h3>
<ol>
  <li>Open the <code>/etc/php5/fpm/pool.d/www.conf</code> file:
    <div class="hacker">sudo vim /etc/php5/fpm/pool.d/www.conf</div></li> 
  <li>Find the <code>listen</code> directives and set it as follows:
    <div class="hacker">listen = /var/run/php5-fpm.sock</div></li>
  <li>Find the <code>listen.owner</code>, <code>listen.group</code>, and <code>listen.mode</code> directives and confirm/modify them as follows:
    <div class="hacker">listen.owner = www-data<br />
    listen.group = www-data<br />
    listen.mode&nbsp; = 0660</div></li>
  <li>Find the <code>owner</code> and  <code>group</code> directives, and modify them as follows:
    <div class="hacker">user = www-data<br />
    group = www-data</div></li>
   <li>Save and close the file:
      <div class="hacker">:wq!</div></li>
</ol>
 
<h3>Restart PHP</h3>
<ul>
  <li>Restart PHP:
    <div class="hacker">sudo service php5-fpm restart</div></li>
</ul>

<h2>NGINX - Configuring PHP</h2>
<p>All of your LEMP stack components are now installed. You need only make NGINX aware that a FastCGI server exists to process PHP requests.
</p>
<ol> 
  <li>Open <code>/etc/nginx/sites-available/default</code>:
      <div class="hacker">sudo vim /etc/nginx/sites-available/default</div>
  <li>Find the <code>server</code> context, which will look something like this:</p>
      <div class="hacker">server {
      <br />&nbsp; listen 80; 
      <br />&nbsp; root /usr/share/nginx/html;
      <br />&nbsp; index  index.html index.htm;
      <br />&nbsp; server_name localhost;</div></li>
  <li>Edit the <code>index</code> and <code>server_name</code> parameters to look like this:  
     <div class="hacker">&nbsp; index  index.php index.html index.htm;
             <br />&nbsp; server_name <em><u>the name of your server</u></em>;</div></li>
  <li>Find the <code>location</code> context will look like this:  
    <div class="hacker">&nbsp; location / {
             <br />&nbsp;&nbsp;&nbsp;&nbsp; try_files $uri $uri/ =404;
             <br />&nbsp;&nbsp;&nbsp;&nbsp; }
             <br />&nbsp; error_page 404 /404.html;
             <br />&nbsp; error_page 500 502 503 504 /50x.html;
             <br />&nbsp; location = /50x.html {
             <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; root /usr/share/nginx/html;
             <br />&nbsp; }
             </div></li>
  <li>Either uncomment out or add the following lines in the <code>location</code> context:
      <div class="hacker">&nbsp; location / {
             <br />&nbsp;&nbsp;&nbsp;&nbsp; try_files $uri $uri/ /index.html;
             <br />&nbsp;&nbsp;&nbsp;&nbsp; }
             <br />&nbsp; error_page 404 /404.html;
             <br />&nbsp; error_page 500 502 503 504 /50x.html;
             <br />&nbsp; location = /50x.html {
             <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; root /usr/share/nginx/html;
             <br />&nbsp; }
             <br />
             <br />
             # pass the PHP scripts to FastCGI server listening on the php-fpm socket
             <br />
             <br />
             location ~ \.php$ {
             <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; try_files $uri =404;
             <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fastcgi_pass unix:/var/run/php5-fpm.sock;
             <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fastcgi_index index.php;
             <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
             <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; include fastcgi_params; 
      <br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; }&nbsp; </div></li> 
    <li>Save and close the file:
      <div class="hacker">:wq!</div></li>
    <li>Restart NGINX:
    <div class="hacker">sudo service nginx restart</div></li>
    </ol>  
      <p class="note">If NGINX fails to restart, check your edits. Make sure that all of your braces ({}) are closed and that each directive ends with a semi-colon (;). </p>
            
<h2>Verify PHP is running</h2>
<ol>
  <li>Create a <code>info.php</code> file to ensure PHP is running:
    <div class="hacker">sudo vim usr/share/nginx/html/info.php</div></li>
  <li>Paste in the following contents:
    <div class="hacker">&lt;?php<br />
    phpinfo();<br /> 
    ?&gt;  </div></li>
    <li>Go to:<br/>
      <strong>http://<em><u>your server's IP address</u></em>/info.php</strong>
      <p class="note">COMPANY_NAME Cloud Server customers can use <article id="19041" />.</li></li>
</ol>
<p>A page full of statistics with a PHP logo in the upper right-hand corner will be displayed.</p>

<!--<h2>Next steps</h2>
    <p>You have just installed a LEMP stack. You may want to add: </p>
    <ul><li><a href="http://17360%20-%20Configure%20NGINX%20Server%20Blocks%20-%20ALL%20DISTROS.html">Additional NGINX server blocks</a></li>
      <li> <a href="http://17500%20-%20Configure%20NGINX%20as%20a%20reverse%20proxy%20-%20ALL%20DISTROS.html">More advanced NXINX functionality</a></li>
      <li><a href="http://17932%20-%20Setup%20FastCGI%20Caching%20with%20NGINX%20on%20your%20server%20-%20Arch%20Linux.html">Enhanced PHP functionality</a></li>

        </ul>-->
</body>
</html>